services:
  mongodb:
    image: mongo:7
    ports: [ "27017:27017" ]
    volumes: [ mongo_data:/data/db ]
    # (explain: named volume keeps data between restarts)

  redis:
    image: redis:7-alpine
    ports: [ "6379:6379" ]

  backend:
    build: ./backend
    ports: [ "8000:8000" ]
    depends_on: [ mongodb, redis ]
    env_file: ./backend/.env.docker
    # (explain: depends_on means backend waits for 
    #  mongo and redis to start before it starts)

  worker:
    build: ./backend
    command: celery -A celery_worker worker --loglevel=info
    depends_on: [ mongodb, redis, backend ]
    env_file: ./backend/.env.docker
    # (explain: same image as backend but runs 
    #  celery instead of uvicorn)

  frontend:
    build: ./frontend
    ports: [ "3000:80" ]
    depends_on: [ backend ]
    environment:
      - VITE_API_URL=http://localhost:8000

volumes:
  mongo_data:
